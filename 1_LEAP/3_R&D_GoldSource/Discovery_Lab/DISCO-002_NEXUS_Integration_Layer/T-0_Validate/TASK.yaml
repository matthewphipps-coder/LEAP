# Stage T-0: Validate (Lock)
# DISCO-002: NEXUS Integration Layer

stage:
  id: "T-0"
  name: "Validate (Lock)"
  status: "complete"
  completedAt: "2026-01-23T12:01:00Z"

# =============================================================================
# VALIDATION CHECKLIST
# =============================================================================

validationChecklist:
  - check: "Spec follows GoldSource format"
    status: "✅ PASS"
  - check: "Events have examples"
    status: "✅ PASS"
  - check: "Data contracts are typed"
    status: "✅ PASS"
  - check: "Implementation checklist is actionable"
    status: "✅ PASS"
  - check: "Acceptance criteria are testable"
    status: "✅ PASS"

# =============================================================================
# PRE-REQUISITES ANALYSIS
# =============================================================================

prerequisitesAnalysis:
  summary: |
    SPEC-NEXUS-integration requires hosted infrastructure (Firebase Functions + Cloud Run)
    that does NOT currently exist in GoldSource. This must be addressed before implementation.

  currentGoldSourceState:
    hasFirebaseAuth: true
    hasFirestore: true
    hasFirebaseFunctions: false
    hasCloudRun: false
    hasHostedBackend: false
    deploymentModel: "Local development only (no production hosting)"

  gapsIdentified:
    - id: "GAP-001"
      name: "No Firebase Functions project"
      description: "GoldSource does not have a functions/ directory or Firebase Functions setup"
      requiredFor: "Orchestrator endpoints (/api/intent, /api/activity, /api/commit)"
      action: "Initialize Firebase Functions before implementing NEXUS-INTEGRATION"
      
    - id: "GAP-002"
      name: "No Cloud Run configuration"
      description: "No Cloud Run or container deployment setup exists"
      requiredFor: "MCP Server hosting (Python)"
      action: "Create Cloud Run deployment config before implementing NEXUS-INTEGRATION"
      
    - id: "GAP-003"
      name: "No hosted deployment pipeline"
      description: "No CI/CD or deployment scripts for cloud services"
      requiredFor: "Production deployment of orchestrator and MCP server"
      action: "Establish deployment workflow before implementing NEXUS-INTEGRATION"
      
    - id: "GAP-004"
      name: "No Secret Manager integration"
      description: "Secrets (API keys, SoR credentials) management not established"
      requiredFor: "Secure credential storage for Claude API, ServiceNow"
      action: "Integrate Secret Manager before implementing NEXUS-INTEGRATION"

# =============================================================================
# RECOMMENDED PRE-REQUISITE BACKLOG ITEMS
# =============================================================================

recommendedBacklogItems:
  - id: "LEAP-066 (proposed)"
    name: "GoldSource Hosted Infrastructure"
    description: "Establish Firebase Functions + Cloud Run infrastructure for GoldSource"
    scope:
      - "Initialize Firebase Functions project"
      - "Create Cloud Run deployment configuration"
      - "Integrate Secret Manager"
      - "Create deployment scripts"
    mustCompleteBefore: "NEXUS-INTEGRATION implementation"
    estimatedEffort: "medium"

  - id: "LEAP-065 (existing)"
    name: "NEXUS Workbench Implementation"
    description: "Implement the UI layer from DISCO-001"
    status: "In backlog"
    relationship: "NEXUS-INTEGRATION depends on window.NEXUS API"

# =============================================================================
# IMPLEMENTATION ORDER (RECOMMENDED)
# =============================================================================

implementationOrder:
  - order: 1
    item: "LEAP-065: NEXUS Workbench"
    rationale: "UI layer must exist before integration layer can call it"
    
  - order: 2
    item: "LEAP-066: Hosted Infrastructure (NEW)"
    rationale: "Cloud infrastructure required before integration layer can be deployed"
    
  - order: 3
    item: "NEXUS-INTEGRATION implementation"
    rationale: "Depends on both UI layer and hosted infrastructure"

# =============================================================================
# LOCKED ARTIFACTS
# =============================================================================

lockedArtifacts:
  - path: "T-2_Define/SPEC-NEXUS-integration.yaml"
    version: "1.0.0"
    status: "LOCKED"
    description: "Build-ready functional specification"

# =============================================================================
# BUILD HANDOFF
# =============================================================================

buildHandoff:
  prerequisites:
    - "LEAP-065: NEXUS Workbench (must be complete)"
    - "LEAP-066: Hosted Infrastructure (must be complete)"
    
  primarySpec: "T-2_Define/SPEC-NEXUS-integration.yaml"
  
  buildGuidance: |
    1. Verify NEXUS Workbench (window.NEXUS API) is implemented
    2. Verify Firebase Functions and Cloud Run are configured
    3. Use SPEC-NEXUS-integration.yaml as primary implementation guide
    4. Follow 8-stage GoldSource Increment methodology
    5. Test with ServiceNow dev instance when available

# =============================================================================
# DISCOVERY CLOSURE
# =============================================================================

discoveryClosure:
  discoveryId: "DISCO-002"
  title: "NEXUS Integration Layer"
  startDate: "2026-01-23"
  endDate: "2026-01-23"
  
  keyOutcomes:
    - "Defined SoR-agnostic integration pattern (adapter model)"
    - "Established event contract (7 event types)"
    - "Designed hosted architecture (Firebase + Cloud Run)"
    - "Identified pre-requisites blocking implementation"
    - "Validated design against MCP ecosystem"
  
  scopeRefinements:
    - "Limited to Scenarios 1 & 2 (pull-only, user-initiated)"
    - "Deferred Scenarios 3 & 4 to DISCO-003 (SoR push)"
    - "Hosted-first design (not local Claude)"
  
  nextSteps:
    - "Add LEAP-066 to backlog (Hosted Infrastructure)"
    - "Implement LEAP-065 first (NEXUS Workbench)"
    - "Implement LEAP-066 second (Hosted Infrastructure)"
    - "Then implement NEXUS-INTEGRATION"

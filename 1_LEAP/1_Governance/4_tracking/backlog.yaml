# =============================================================================
# LEAP FEATURE BACKLOG
# =============================================================================
# INSTRUCTIONS FOR AI AGENTS:
# 1. This file contains ONLY active backlog items (proposed, approved, in-progress)
# 2. Completed and superseded items are in backlog-archive.yaml
# 3. Do NOT add completed items here - archive them instead
# 4. Check backlog-categories.yaml for valid category IDs
# 5. Every new item needs acceptanceCriteria for verification
# =============================================================================

metadata:
  type: "tracking"
  name: "LEAP Feature Backlog"
  purpose: "Feature roadmap and priorities - ACTIVE ITEMS ONLY"
  version: "4.0.0"
  created: "2026-01-16"
  lastUpdated: "2026-01-22"
  status: "active"
  archiveRef: "1_LEAP/1_Governance/4_tracking/backlog-archive.yaml"

summary:
  totalActiveItems: 10
  immediate: 1  # LEAP-063
  shortTerm: 9
  mediumTerm: 0
  future: 0
  
  statusBreakdown:
    proposed: 9
    approved: 0
    inProgress: 1  # LEAP-063
  
  archivedItems:
    total: 57
    completed: 45
    superseded: 12
    archiveDate: "2026-01-22"
  
  note: "Backlog hygiene complete - 57 items archived (2026-01-22)"
  
  categoriesRef: "1_LEAP/1_Governance/4_tracking/backlog-categories.yaml"

# =============================================================================
# IMMEDIATE PRIORITY
# =============================================================================

priorities:
  immediate:
    - id: "LEAP-063"
      name: "AI Workflow Compliance (GoldSource Increment)"
      category: "governance"
      priority: "immediate"
      status: "in-progress"
      
      description: |
        AI agents are violating GoldSource Increment workflow protocols in ways that
        undermine the governance model. This is a systemic issue requiring documentation
        fixes, structural changes, and validation mechanisms.
      
      # =========================================================================
      # ROOT CAUSE ANALYSIS (from governance review 2026-01-22)
      # =========================================================================
      rootCauseAnalysis:
        summary: "Governance is sophisticated but AI cognitive load is too high"
        
        documentationGaps:
          - file: "bump-protocol.yaml"
            issue: "Doesn't explicitly state '!Bump does NOT grant !Proceed'"
            line: "Missing negative guidance"
          
          - file: "goldsource-increment.yaml"
            issue: "Stage gates say 'gate: !Proceed' but no STOP instruction"
            line: "Stages list gates but don't enforce stopping"
          
          - file: "pulse-protocol.yaml"
            issue: "stageTransitions.enforcement lists invalid triggers but not in AI-scannable format"
            line: "Lines 93-96 - buried in nested YAML"
          
          - file: "ai-onboard.yaml"
            issue: "criticalRules section is good but doesn't cover crash recovery"
            line: "Missing rule about post-crash state"
        
        structuralIssues:
          - "AI must read 5+ files to understand workflow - cognitive overload"
          - "Two similar methodologies (pulse-protocol vs goldsource-increment) cause confusion"
          - "No single-page decision tree for 'what do I do now?'"
          - "Negative examples (what NOT to do) are sparse"
      
      # =========================================================================
      # OBSERVED FAILURE MODES
      # =========================================================================
      failureModes:
        - id: "FM-001"
          name: "Stage Skip"
          behavior: "AI jumps from Stage 1 to Stage 5 without intermediate stages"
          cause: "Eager to implement; gates not enforced with explicit STOP"
          frequency: "Common"
        
        - id: "FM-002"
          name: "Bump-as-Proceed"
          behavior: "AI treats !Bump as permission to continue where it left off"
          cause: "!Bump protocol says 'WAIT for !Proceed' but AI conflates triggers"
          frequency: "Observed in Phase 31"
        
        - id: "FM-003"
          name: "Crash Auto-Continue"
          behavior: "After crash/restart, AI assumes prior !Proceed still valid"
          cause: "No explicit rule that !Proceed expires on session boundary"
          frequency: "Observed"
        
        - id: "FM-004"
          name: "Implicit Proceed"
          behavior: "AI interprets 'yes', 'continue', 'sounds good' as !Proceed"
          cause: "Rule exists but is in stageTransitions.enforcement, not prominently placed"
          frequency: "Occasional"
        
        - id: "FM-005"
          name: "Methodology Confusion"
          behavior: "AI uses pulse-protocol stages for GoldSource work or vice versa"
          cause: "Two 8-stage lifecycles with different purposes; scope definitions exist but require inference"
          frequency: "Occasional"
      
      # =========================================================================
      # PROPOSED SOLUTIONS
      # =========================================================================
      proposedSolutions:
        
        part1_documentationFixes:
          name: "Add Explicit Negative Guidance"
          files:
            - file: "bump-protocol.yaml"
              add: |
                criticalClarification:
                  rule: "!Bump is NOT !Proceed"
                  meaning: "!Bump means 'recover and report status' - you still need !Proceed to continue work"
                  afterBump: "ALWAYS request !Proceed before resuming implementation"
            
            - file: "goldsource-increment.yaml"
              add: |
                # Add to each stage after 'gate: !Proceed':
                enforcement: "STOP HERE. Do not proceed to next stage until user says !Proceed."
            
            - file: "ai-onboard.yaml"
              add: |
                # Add to criticalRules:
                rule6:
                  name: "Session Boundaries Reset Approvals"
                  consequence: "After crash/restart, prior !Proceed is INVALID - re-request"
        
        part2_structuralChanges:
          name: "Reduce Cognitive Load"
          items:
            - action: "Create AI_QUICKREF.yaml"
              purpose: "Single-page decision tree and rule summary (~100 lines)"
              content: "Triggers, what they mean, what to do next"
            
            - action: "Add STOP markers to stage definitions"
              purpose: "Make gates visually unmissable"
              example: |
                gate: "!Proceed"
                action: "⛔ STOP - Request !Proceed from user before continuing"
            
            - action: "Add 'Common Mistakes' section to goldsource-increment.yaml"
              purpose: "Learn from observed failures"
              content: "FM-001 through FM-005 as explicit warnings"
        
        part3_validationMechanisms:
          name: "Runtime Checks"
          items:
            - action: "Stage artifact verification"
              check: "Before Stage N+1, verify stage-N-*.yaml exists"
            
            - action: "!Proceed logging"
              check: "Stage artifacts must include proceedReceivedAt timestamp"
            
            - action: "Session boundary detection"
              check: "If conversation context is missing, assume fresh session - no prior approvals"
      
      rationale: |
        GoldSource Increment methodology depends on explicit stage gates and user approvals.
        Current documentation is comprehensive but distributed across 5+ files, creating
        cognitive overload. AI agents are not malicious - they're confused by complexity.
        
        The governance model is sound; the presentation needs optimization for AI consumption.
        Think of this as "API documentation" - make the contract unmissable.
      
      acceptanceCriteria:
        # Documentation
        - "bump-protocol.yaml includes explicit '!Bump is NOT !Proceed' statement"
        - "goldsource-increment.yaml stages include STOP instructions, not just gate names"
        - "ai-onboard.yaml includes crash recovery rule (session resets approvals)"
        
        # Structure
        - "AI_QUICKREF.yaml created with decision tree and rule summary"
        - "goldsource-increment.yaml includes 'Common Mistakes' section with FM-001 through FM-005"
        
        # Validation
        - "Next GoldSource phase (Phase 32+) completes without stage-skip or bump-as-proceed violations"
        - "Stage artifacts include proceedReceivedAt field"
      
      estimatedEffort: "medium"
      dependencies: []
      addedDate: "2026-01-22"
      expandedDate: "2026-01-22"
      source: "User observation during Phase 31 + comprehensive governance review"
      
      implementationNotes: |
        Recommend implementing in this order:
        1. Quick wins: Add negative guidance to bump-protocol.yaml and ai-onboard.yaml
        2. Core fix: Add STOP markers to goldsource-increment.yaml stages
        3. Add Common Mistakes section
        4. Update stage templates
        5. Validation: Test with Phase 32
      
      # =========================================================================
      # IMPLEMENTATION CHECKLIST (Scoped items for this backlog)
      # =========================================================================
      implementationChecklist:
        - id: "A1"
          file: "1_LEAP/1_Governance/2_protocols/bump-protocol.yaml"
          task: "Add criticalClarification section: '!Bump is NOT !Proceed'"
          status: "pending"
        
        - id: "A2"
          file: "1_LEAP/1_Governance/0_start/ai-onboard.yaml"
          task: "Add Rule 6: Session Boundaries Reset Approvals"
          status: "pending"
        
        - id: "A3"
          file: "1_LEAP/2_Build_GoldSource/Methodology/goldsource-increment.yaml"
          task: "Add STOP instructions to each stage gate"
          status: "pending"
        
        - id: "A6"
          file: "1_LEAP/2_Build_GoldSource/Methodology/goldsource-increment.yaml"
          task: "Add Common Mistakes section with FM-001 through FM-005"
          status: "pending"
        
        - id: "A7"
          file: "1_LEAP/1_Governance/5_templates/phase-artifact.yaml"
          task: "Add proceedReceivedAt field to stage artifact template"
          status: "pending"

  # ===========================================================================
  # SHORT-TERM PRIORITY
  # ===========================================================================
  shortTerm:
    # -------------------------------------------------------------------------
    # Security & Quality Gaps
    # -------------------------------------------------------------------------
    - id: "GOV-007"
      name: "Add Security Governance Layer"
      category: "governance"
      priority: "short-term"
      status: "proposed"
      description: "Add security-focused governance: Security Champion persona, RRMD+ security triggers, security review checklist, Constitution Rule 16"
      rationale: "Industry standards (2025-2026) require explicit security review for AI-generated code. LEAP's current governance doesn't address security vulnerabilities."
      acceptanceCriteria:
        - "Security Champion persona (#7) added to agent-persona.yaml"
        - "RRMD+ protocol includes security triggers (auth/data/API changes)"
        - "Security checklist created for pre-deployment gate"
        - "Constitution Rule 16: Security Review Gate added"
      estimatedEffort: "medium"
      dependencies: []
      addedDate: "2026-01-20"
      source: "Critical Review: LEAP vs Industry Standards"

    # -------------------------------------------------------------------------
    # Design System Enhancements
    # -------------------------------------------------------------------------
    - id: "LEAP-061"
      name: "Card System"
      category: "scaffold-conventions"
      priority: "short-term"
      status: "proposed"
      description: "Standardized card component system with priority/severity color coding"
      rationale: "Demos frequently use cards for incidents, changes, CIs - need consistent styling with severity indicators"
      estimatedEffort: "small"
      dependencies: ["LEAP-036"]
      addedDate: "2026-01-22"
      source: "Split from LEAP-039 (generalized from DEFER-004)"
      acceptanceCriteria:
        - "Card base styles documented in design-system.yaml"
        - "Priority/severity color system (critical, high, medium, low)"
        - "Card variants (.card-compact, .card-detailed) if needed"

    - id: "LEAP-062"
      name: "Confetti Celebration"
      category: "scaffold-conventions"
      priority: "short-term"
      status: "proposed"
      description: "Integrate canvas-confetti for success celebrations and delightful UX moments"
      rationale: "Adds polish and delight to demo moments like successful submissions or approvals"
      estimatedEffort: "small"
      dependencies: ["LEAP-036"]
      addedDate: "2026-01-22"
      source: "Split from LEAP-039 (DEFER-006)"
      acceptanceCriteria:
        - "canvas-confetti library integrated"
        - "Utility function for triggering confetti"
        - "Usage documented in design-system.yaml"

    # -------------------------------------------------------------------------
    # App Shell Enhancements
    # -------------------------------------------------------------------------
    - id: "LEAP-042"
      name: "AI Search Interactions"
      category: "scaffold-conventions"
      priority: "short-term"
      status: "proposed"
      description: "Implement AI Search UX: expanded modal, keyboard shortcut (⌘K), blur overlay, escape to close"
      rationale: |
        SPEC-003 Q-002 decision: AI Search in App Shell is slot-only (input box).
        Full interactions deferred to future phase. Prototype has working implementation
        that can be extracted when this backlog item is prioritized.
      acceptanceCriteria:
        - "⌘K / Ctrl+K keyboard shortcut opens expanded search modal"
        - "ESC closes expanded search"
        - "Click outside modal closes it"
        - "Focus automatically moves to search input when modal opens"
        - "Blur overlay behind modal"
      estimatedEffort: "small"
      dependencies: ["LEAP-037"]
      addedDate: "2026-01-21"
      source: "SPEC-003 forensic review - Q-002 decision"

    # -------------------------------------------------------------------------
    # Factory Documentation
    # -------------------------------------------------------------------------
    - id: "LEAP-058"
      name: "State Slice Usage Examples"
      category: "scaffold-conventions"
      priority: "short-term"
      status: "proposed"
      description: |
        Add explicit code examples to 2_GoldSource/meta/ARCHITECTURE.yaml showing
        correct registerStateSlice() usage pattern. Factory AI initially used
        incorrect setState() pattern that doesn't exist.
      rationale: |
        v2.2.0-cmdb-explorer Factory AI attempted wrong API pattern:
          setState('feature', 'setFieldName', value)  // WRONG - doesn't exist
        Correct pattern:
          const stateAPI = registerStateSlice('feature', {...}, {...});
          stateAPI.setFieldName(value);  // Correct
        Factory self-corrected during Stage 6, but pattern should be clearer.
      acceptanceCriteria:
        - "ARCHITECTURE.yaml includes registerStateSlice code example"
        - "Example shows correct API object destructuring pattern"
        - "Next Factory run uses correct pattern without self-correction"
      estimatedEffort: "small"
      dependencies: []
      addedDate: "2026-01-22"
      source: "Factory v2.2.0-cmdb-explorer Stage 8 Closure (LL-001/GSI-001)"

    - id: "LEAP-059"
      name: "Modal Pattern Documentation"
      category: "scaffold-conventions"
      priority: "short-term"
      status: "proposed"
      description: |
        Document the HTML <dialog> modal pattern in 2_GoldSource/meta/design-system.yaml.
        Include when to use <dialog> vs custom popover, accessibility considerations,
        and keyboard handling (Escape to close).
      rationale: |
        v2.2.0-cmdb-explorer used <dialog> for CI detail popup successfully.
        Pattern works well but is not documented in design system, leading to
        potential inconsistency in future Factory runs.
      acceptanceCriteria:
        - "design-system.yaml includes modal/dialog pattern section"
        - "Documents <dialog> element usage with showModal()/close() methods"
        - "Includes accessibility notes (Escape key, focus trap)"
      estimatedEffort: "small"
      dependencies: []
      addedDate: "2026-01-22"
      source: "Factory v2.2.0-cmdb-explorer Stage 8 Closure (GSI-002)"

    # -------------------------------------------------------------------------
    # AI Session Resilience (from v2.2.0-change-approval run)
    # -------------------------------------------------------------------------
    - id: "LEAP-054"
      name: "Add Session Recovery Guidance to Factory Task Template"
      category: "factory-governance"
      priority: "short-term"
      status: "proposed"
      description: |
        Improve session recovery guidance in FACTORY_TASK_TEMPLATE.md.
        Current !bump section is good but could be more prominent.
      rationale: "v2.2.0 run needed manual restart guidance after stage completion"
      acceptanceCriteria:
        - "Session recovery section is more visible in template"
        - "Explicit instructions for mid-stage vs between-stage recovery"
      estimatedEffort: "small"
      dependencies: []
      addedDate: "2026-01-21"
      source: "v2.2.0-change-approval run observation"

    - id: "LEAP-055"
      name: "Consider Stage Progress Indicators in Artifacts"
      category: "factory-governance"
      priority: "short-term"
      status: "proposed"
      description: |
        Add optional stage progress summary to each stage artifact metadata.
        Would help new sessions understand current progress at a glance.
      rationale: "After crashes/restarts, AI must read multiple artifacts to understand state"
      acceptanceCriteria:
        - "Stage artifact templates include optional 'phaseProgress' field"
        - "Field shows stages completed and current status"
      estimatedEffort: "small"
      dependencies: []
      addedDate: "2026-01-21"
      source: "v2.2.0-change-approval run observation"
    
    - id: "LEAP-064"
      name: "LEAP-NEXUS Exec Overview"
      category: "governance"
      priority: "short-term"
      status: "proposed"
      description: "Create a high-end, visual executive overview document for the LEAP-NEXUS project using the premium digital spec template."
      rationale: "Requires a professional, 'pretty' presentation for executive stakeholders to communicate project status and vision effectively."
      acceptanceCriteria:
        - "Use the premium spec design language (glassmorphism/Inter typography)"
        - "Includes high-fidelity hero visuals (AI-generated)"
        - "Design includes print-optimized PDF layout"
        - "Covers LEAP vision, architectural layers, and current status"
      estimatedEffort: "small"
      dependencies: []
      addedDate: "2026-01-22"
      source: "User request for 'pretty' executive docs"

  mediumTerm: []
  future: []

# =============================================================================
# HOW TO ADD NEW ITEMS
# =============================================================================
howToAdd:
  instructions: |
    1. Choose the appropriate priority bucket (immediate/shortTerm/mediumTerm/future)
    2. Use the template below
    3. Check backlog-categories.yaml for valid category IDs
    4. Include acceptanceCriteria for every item
    5. When item is COMPLETE: move to backlog-archive.yaml, update summary counts
    6. When item is SUPERSEDED: move to backlog-archive.yaml with supersessionNote
  
  templateRef: "1_LEAP/1_Governance/5_templates/tracking.yaml"
  categoriesRef: "1_LEAP/1_Governance/4_tracking/backlog-categories.yaml"
  archiveRef: "1_LEAP/1_Governance/4_tracking/backlog-archive.yaml"
  
  template: |
    - id: "FEATURE-XXX"
      name: "Feature name"
      category: "[category-id from backlog-categories.yaml]"
      priority: "immediate|short-term|medium-term|future"
      status: "proposed|approved|in-progress|complete"
      description: "What this feature does"
      rationale: "Why this feature is needed"
      acceptanceCriteria: ["Verifiable condition 1", "Verifiable condition 2"]
      estimatedEffort: "small|medium|large"
      dependencies: []
      addedDate: "YYYY-MM-DD"
      source: "[Reference to finding or conversation]"


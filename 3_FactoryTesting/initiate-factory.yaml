# =============================================================================
# /newfactory WORKFLOW
# =============================================================================
# Triggered when user types: /newfactory
# Creates a new factory instance and generates onboarding prompt
# =============================================================================

metadata:
  name: "Create New Factory"
  trigger: "/newfactory"
  type: "workflow"
  version: "1.0.0"

# =============================================================================
# LEAP KNOWS (pre-configured)
# =============================================================================

leapKnows:
  goldSourceLocation: "2_GoldSource/"
  factoryVersion: "1.0.0"
  defaultDemoLocation: "~/Documents/DemoOutput/"
  defaultFactoryLocation: "~/Documents/DemoInstances/"

# =============================================================================
# WORKFLOW STEPS
# =============================================================================

steps:
  
  1_askUser:
    action: "Ask user for demo details"
    note: "AI suggests next version number, user provides feature name"
    prompts:
      - question: "What feature name for this demo?"
        example: "itsm-dashboard"
        note: "AI will combine with version: NEXUS v1.0.1-[featurename]"
        required: true
      
      - question: "Demo output location?"
        default: "~/Documents/DemoOutput/NEXUS-v[version]-[featurename]/"
        required: false
      
      - question: "Brief scenario description?"
        example: "Major Incident view with AI agent support"
        required: true
    
    versionLogic:
      source: "AI determines from previous demos or starts at v1.0.0"
      format: "vMAJOR.MINOR.PATCH-featurename"
      examples:
        first: "v1.0.0-itsm-dashboard"
        increment: "v1.0.1-approval-flow"
  
  2_createFactoryInstance:
    action: "Copy Gold Source to factory workspace"
    source: "2_GoldSource/"
    destination: "~/Documents/DemoInstances/Factory-[version]/"
    commands:
      - "mkdir -p ~/Documents/DemoInstances/Factory-[version]"
      - "cp -r 2_GoldSource/* ~/Documents/DemoInstances/Factory-[version]/"
  
  3_generateOnboardingPrompt:
    action: "Generate minimal factory onboarding prompt"
    display: true
    principle: "No coaching - Factory reads its own governance"
    template: |
      # DemoFactory Onboarding

      You are a DemoFactory AI.

      **Factory workspace:** [FACTORY_WORKSPACE]
      **Demo output:** [DEMO_OUTPUT]
      **Demo:** NEXUS [VERSION]
      **Scenario:** [SCENARIO]

      Start by reading: `governance/FACTORY_README.yaml`
  
  4_savePrompt:
    action: "Save prompt for repeatability"
    destination: "3_FactoryTesting/prompts/prompt-[VERSION].md"
    purpose: "Enable identical test re-runs after governance changes"
    commands:
      - "mkdir -p 3_FactoryTesting/prompts"
      - "Save generated prompt to 3_FactoryTesting/prompts/prompt-[VERSION].md"
  
  5_confirmReady:
    action: "Confirm factory is ready"
    message: |
      âœ… Factory instance created!
      
      Factory workspace: [FACTORY_WORKSPACE]
      Demo output: [DEMO_OUTPUT]
      Prompt saved: 3_FactoryTesting/prompts/prompt-[VERSION].md
      
      NEXT STEPS:
      1. Copy the onboarding prompt above
      2. Start a NEW AI conversation (not this one)
      3. Paste the prompt to initialize the Factory AI
      
      The Factory AI is completely separate from this LEAP session.


# =============================================================================
# STAGE 5: IMPLEMENTATION GOVERNANCE
# =============================================================================
# Read this file at Stage 5 entry. Contains all rules, examples, and
# validation for Implementation stage.
# =============================================================================

metadata:
  stage: 5
  name: "Implementation"
  purpose: "Build the demo according to approved design"
  version: "1.0.0"
  created: "2026-01-20"

# =============================================================================
# ROLE ASSIGNMENTS
# =============================================================================

roles:
  lead: "Code Quality Czar"
  responsibility: "Ensure all code follows AI-First standards and naming conventions"
  
  reviewers:
    - role: "Principal Architect"
      focus: "Verify implementation matches design, structure is sound"

# =============================================================================
# MANDATORY READING
# =============================================================================

mandatoryReading:
  before: "Starting implementation"
  files:
    - file: "stage-4-design.yaml"
      why: "Know exactly what to build"
    - file: "This file (stage-5-governance.yaml)"
      why: "Know the rules for HOW to build"

# =============================================================================
# CODE STANDARDS - WITH EXAMPLES
# =============================================================================

codeStandards:

  aiFirstHeaders:
    rule: "Every new JavaScript file MUST have AI-First header"
    required: true
    
    template: |
      /**
       * @file [filename]
       * @purpose [what this file does - one sentence]
       * @layer [core|ui|feature]
       * @dependencies [files this imports from]
       * @dependents [files that import this]
       * @locked false
       * @modifyImpact [what changes if this file is modified]
       */
    
    example: |
      /**
       * @file incident-data.js
       * @purpose Mock incident data for major incident dashboard demo
       * @layer feature
       * @dependencies []
       * @dependents [incident-cards-ui.js, incident-dialog-ui.js]
       * @locked false
       * @modifyImpact [incident data displayed across UI]
       */
  
  moduleContract:
    rule: "Every new module MUST export MODULE_CONTRACT"
    required: true
    
    example: |
      export const MODULE_CONTRACT = {
        provides: ['initIncidentCards', 'renderIncidentCards'],
        requires: ['incident-data.js', 'logger.js']
      };

# =============================================================================
# NAMING CONVENTIONS - WITH EXAMPLES
# =============================================================================

namingConventions:

  featurePaths:
    rule: "Feature folders use SINGULAR naming"
    required: true
    
    correct:
      - "features/incident/"
      - "features/dashboard/"
      - "features/notification/"
    
    incorrect:
      - "features/incidents/"
      - "features/dashboards/"
      - "features/notifications/"
    
    verification: "ls features/ - all folders should be singular nouns"
  
  fileNames:
    rule: "All files use kebab-case"
    required: true
    
    correct:
      - "incident-data.js"
      - "incident-cards-ui.js"
      - "incident-dialog.css"
    
    incorrect:
      - "incidentData.js"
      - "IncidentCards.js"
      - "incident_dialog.css"
  
  componentStructure:
    rule: "UI components have co-located JS and CSS"
    required: true
    
    correct: |
      ui/components/incident-cards/
        ├── incident-cards-ui.js
        └── incident-cards.css
    
    incorrect: |
      ui/components/incident-cards.js  (no folder)
      ui/styles/incident-cards.css     (CSS in wrong place)

# =============================================================================
# CSS STANDARDS
# =============================================================================

cssStandards:

  naming:
    rule: "Use BEM-lite naming pattern"
    required: true
    
    pattern: "[block]__[element]--[modifier]"
    
    examples:
      - ".incident-card"
      - ".incident-card__header"
      - ".incident-card__priority--p1"
      - ".incident-card--active"
  
  variables:
    rule: "Use CSS variables from design system, no magic values"
    required: true
    
    correct: |
      color: var(--text-primary);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
    
    incorrect: |
      color: #333333;
      padding: 16px;
      border-radius: 8px;

# =============================================================================
# DOCUMENTATION UPDATES
# =============================================================================

documentationUpdates:

  functionalityYaml:
    rule: "Add new features to functionality.yaml in demo output"
    required: true
    
    location: "demo-output/meta/functionality.yaml (or create if missing)"
    
    template: |
      - id: "FEATURE-XXX"
        name: "Feature Name"
        status: "implemented"
        description: "What this feature does"
        files:
          - "path/to/file1.js"
          - "path/to/file2.js"
    
    verification: "grep for new feature name in functionality.yaml"
  
  wireframes:
    rule: "If design references wireframes, files MUST exist in factory workspace"
    required: true
    
    verification: |
      1. Read stage-4-design.yaml for wireframe file references
      2. ls factory-workspace/ for each referenced file
      3. If file missing, either create it or remove reference

# =============================================================================
# LOCKED FILES - DO NOT MODIFY
# =============================================================================

lockedFiles:
  rule: "These files CANNOT be modified in demos"
  required: true
  
  list:
    - "core/state.js"
    - "core/firebase.js"
    - "core/constants.js"
    - "core/logger.js"
    - "ui/styles/variables.css"
    - "ui/styles/base.css"
    - "ui/styles/buttons.css"
    - "ui/styles/inputs.css"
  
  verification: "git diff should show no changes to these files"

# =============================================================================
# EXIT CHECKLIST - RUN BEFORE REQUESTING !PROCEED
# =============================================================================

exitChecklist:
  instruction: "Run each check. Report results. Do NOT request !Proceed until all pass."
  
  checks:
    - id: "EC-01"
      check: "All new .js files have AI-First header"
      how: "For each new file, verify @file, @purpose, @layer, @dependencies, @dependents, @locked exist"
      pass: "All headers present and complete"
      fail: "Add missing headers before proceeding"
    
    - id: "EC-02"
      check: "All new modules have MODULE_CONTRACT"
      how: "grep 'MODULE_CONTRACT' in each new .js file"
      pass: "All modules have contract"
      fail: "Add MODULE_CONTRACT to modules missing it"
    
    - id: "EC-03"
      check: "Feature paths use singular naming"
      how: "ls features/ - verify no plural folder names"
      pass: "All singular (incident, dashboard, etc.)"
      fail: "Rename folders to singular form"
    
    - id: "EC-04"
      check: "File names are kebab-case"
      how: "ls all new files - verify no camelCase or snake_case"
      pass: "All kebab-case"
      fail: "Rename files to kebab-case"
    
    - id: "EC-05"
      check: "CSS uses BEM-lite naming"
      how: "Review CSS classes in new .css files"
      pass: "All follow [block]__[element]--[modifier] pattern"
      fail: "Rename classes to BEM-lite"
    
    - id: "EC-06"
      check: "No magic values in CSS"
      how: "grep for hex colors, px values not using var()"
      pass: "All values use CSS variables"
      fail: "Replace magic values with var(--token)"
    
    - id: "EC-07"
      check: "Locked files not modified"
      how: "Verify no changes to files in lockedFiles list"
      pass: "No locked files touched"
      fail: "Revert any locked file changes"
    
    - id: "EC-08"
      check: "functionality.yaml updated (or created)"
      how: "Check demo-output for functionality.yaml with new features listed"
      pass: "New features documented"
      fail: "Add feature entries to functionality.yaml"
    
    - id: "EC-09"
      check: "Wireframes exist if referenced in design"
      how: "Cross-reference stage-4-design.yaml wireframe files with factory workspace"
      pass: "All referenced files exist OR references removed"
      fail: "Create missing wireframes or remove stale references"

# =============================================================================
# REPORT FORMAT
# =============================================================================

exitReport:
  instruction: "Before requesting !Proceed, report checklist results in this format"
  
  template: |
    ## Stage 5 Exit Checklist Results
    
    | Check | Status | Notes |
    |-------|--------|-------|
    | EC-01 AI-First headers | ✅/❌ | [details] |
    | EC-02 MODULE_CONTRACT | ✅/❌ | [details] |
    | EC-03 Singular paths | ✅/❌ | [details] |
    | EC-04 Kebab-case files | ✅/❌ | [details] |
    | EC-05 BEM-lite CSS | ✅/❌ | [details] |
    | EC-06 No magic values | ✅/❌ | [details] |
    | EC-07 Locked files | ✅/❌ | [details] |
    | EC-08 functionality.yaml | ✅/❌ | [details] |
    | EC-09 Wireframes exist | ✅/❌ | [details] |
    
    **Ready for !Proceed:** [Yes/No - must be Yes before requesting]

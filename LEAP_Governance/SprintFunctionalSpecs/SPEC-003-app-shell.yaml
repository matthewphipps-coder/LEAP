# =============================================================================
# SPRINT FUNCTIONAL SPEC: Extensible App Shell
# =============================================================================
# Source: GoldSource scaffold analysis + user requirements
# Purpose: Make index.html a proper extensible scaffold for demos
# =============================================================================

metadata:
  specId: "SPEC-003"
  name: "Extensible App Shell"
  version: "1.3.0"
  created: "2026-01-20"
  lastUpdated: "2026-01-21"
  status: "ready-for-implementation"
  effort: "medium"
  
  # Backlog linkage
  backlogId: "LEAP-037"  # To be created
  targetPhase: null

# =============================================================================
# REFERENCE IMPLEMENTATION (Source of Truth)
# =============================================================================

referenceImplementation:
  prototype: "SprintFunctionalSpecs/SPEC-003-prototype.html"
  prototypeVersion: "v9"
  
  # === CRITICAL: What the Prototype IS and IS NOT ===
  prototypeRole: |
    The prototype is a VISUAL CONTRACT - it shows exactly what the implementation 
    must look like and how it must behave. 
    
    IS: Visual/functional reference - "match this exactly"
    IS: Source of truth for colors, spacing, layouts, animations
    IS: Behavioral reference - clicks, hovers, transitions work this way
    
    IS NOT: Copy-paste code source
    IS NOT: Architecture reference (it's a monolith for demo purposes)
    IS NOT: Implementation pattern (it has inline styles, no modules)
    
    The implementation phase MUST produce the same visual/behavioral result 
    using proper Gold Source architecture:
    - Modular component files (*-ui.js, *.css)
    - AI-First headers on all files
    - No inline styles
    - Config-driven extensibility
  
  description: |
    Opening prototype in browser shows the EXACT target:
    - Floating header (no background) with customer logo, NEXUS brand, page tabs, centered search, action buttons
    - Floating pill sidebar with circular button highlights and tooltips
    - Exact header layout: [Logo max-160px] [NEXUS] [Tabs] <center> [Search] <right> [Bell+Badge] [Settings] [Theme] [Avatar]
    - Exact color values and glassmorphism effects
    - Exact animations and transitions
  
  # External dependencies with pinned versions
  dependencies:
    - name: "Lucide Icons"
      cdn: "https://unpkg.com/lucide@latest"
      purpose: "Modern icon set for nav, header tabs, and action buttons"
      note: "Prototype uses @latest for convenience. Implementation MUST pin to stable version in Gold Source."
    
  # Implementation guidance for dev agents
  devAgentGuidance:
    - "Prototype is VISUAL REFERENCE - match the look and behavior exactly"
    - "Do NOT copy prototype code - implement with Gold Source patterns"
    - "Extract CSS values from prototype (colors, sizes, spacing)"
    - "Use exact Lucide icon names specified in configs"
    - "Maintain config-driven architecture for Factory extensibility"
    - "All new code must use existing CSS variables from variables.css"
    - "No inline styles - use class-based styling"
    - "Components must follow GoldSource patterns (*-ui.js + *.css)"
    - "Add AI-First headers to all new files"

# =============================================================================
# LEAP COMPLIANCE REQUIREMENTS
# =============================================================================

leapCompliance:
  principles:
    - name: "No Vibe Code"
      requirement: "All implementation must follow spec exactly"
      enforcement: "Prototype serves as visual test - output must match"
    
    - name: "Config-Driven Extensibility"
      requirement: "New pages/nav items added via config arrays only"
      enforcement: "SIDEBAR_NAV array, PAGES array - no hardcoding"
    
    - name: "Component Isolation"
      requirement: "Each component in its own folder with -ui.js suffix"
      enforcement: "Follow GoldSource/scaffold/ui/components/ structure"
    
    - name: "CSS Variable Usage"
      requirement: "Use design tokens, not raw values"
      enforcement: "All colors from --accent-*, --bg-*, --text-* etc."
    
    - name: "Accessibility"
      requirement: "All interactive elements must be keyboard accessible"
      enforcement: |
        - Icon buttons: aria-label required
        - Tab navigation: Arrow keys cycle through tabs
        - Settings dialog: Focus trap, ESC to close
        - Per architectural-standards.yaml accessibilityRequirements
    
    - name: "Locked File Respect"
      requirement: "Do not modify locked core files"
      enforcement: "Check file headers for lock status"

  qualityGates:
    - gate: "Visual Match"
      check: "Browser side-by-side with prototype"
      pass: "Pixel-level match on all key elements"
    
    - gate: "Extensibility Test"
      check: "Add new nav item to SIDEBAR_NAV"
      pass: "Item appears without code changes"
    
    - gate: "Theme Parity"
      check: "Toggle between dark/light themes"
      pass: "All elements properly themed"

# =============================================================================
# CURRENT STATE - What already exists in GoldSource scaffold
# =============================================================================

currentState:
  summary: "GoldSource has basic shell but lacks extensibility for customer demos"
  
  alreadyImplemented:
    - feature: "Header component"
      location: "ui/components/header/header-ui.js"
      status: "‚ö†Ô∏è Basic"
      note: "Has logo text, theme toggle, user avatar, logout"
    
    - feature: "Sidebar with collapse"
      location: "ui/components/sidebar/sidebar-ui.js"  
      status: "‚ö†Ô∏è Basic"
      note: "Can collapse/expand but only 1 hardcoded nav item"
    
    - feature: "Canvas area"
      location: "ui/components/canvas/canvas-ui.js"
      status: "‚ö†Ô∏è Basic"
      note: "Single content area, no page system"
  
  missingFeatures:
    - feature: "Customer logo slot"
      impact: "Can't brand header for customer demos"
      priority: "must-have"
    
    - feature: "Page switcher/tabs"
      impact: "Can only show one view, can't add Reports/Calendar/etc"
      priority: "must-have"
    
    - feature: "Extensible sidebar"
      impact: "Hard to add new nav items for demos"
      priority: "must-have"
    
    - feature: "AI search box"
      impact: "No floating search/command palette"
      priority: "should-have"
    
    - feature: "Settings page"
      impact: "No way to configure app settings"
      priority: "should-have"

# =============================================================================
# SCOPE DEFINITION
# =============================================================================

scope:
  problem: |
    GoldSource index.html is a basic shell that requires significant edits
    to create different demo scenarios. Key limitations:
    1. Header is static - hardcoded logo, no search, no page navigation
    2. Sidebar has only 1 nav item - hard to extend
    3. Single canvas area - no multi-page support
    4. No settings capability
    
  goal: |
    Transform index.html into an extensible scaffold where:
    - Demos can swap customer logo with 1 image change
    - New pages (Reports, Calendar, CSR, etc) can be added via config
    - Sidebar nav items can be added via config
    - AI search box and settings are ready-to-use slots
    
  notInScope:
    - Actual settings page implementation (just the slot/shell)
    - AI search functionality (just the UI slot)
    - Specific page implementations (just the page system)
    - Mobile responsive overhaul
  
  successCriteria:
    - Header has customer logo slot (image, not text)
    - Header has page switcher tabs
    - Header has AI search box slot (floating)
    - Header has settings button that opens settings panel
    - Sidebar nav items defined in config (add via array)
    - Page system allows multiple views (switch via tabs)
    - Demo can add new page with minimal code

# =============================================================================
# FUNCTIONAL REQUIREMENTS
# =============================================================================

requirements:
  
  functional:
    # --- Header Enhancement ---
    - id: "FR-001"
      name: "Customer Logo Slot"
      description: "Replaceable customer logo in header (separate from brand text)"
      priority: "must-have"
      currentState: "FINALIZED - design verified in prototype v7"
      acceptance: |
        - Header has dedicated .header-logo container (min 80px, max 160px width)
        - Contains theme-swappable logo images ("dark" and "light" configuration)
        - Logo managed via "Branding" settings panel (FR-004E) with persistent storage
        - Display options: contain, cover, fill (stretch)
        - Logo separate from NEXUS brand text
        - Brand text always visible, inherits --text-primary color
      uiDetails:
        html: |
          <!-- Customer Logo (swappable) -->
          <div class="header-logo">
            <img src="assets/logo-dark.svg" class="header-logo-img logo-dark" />
            <img src="assets/logo-light.svg" class="header-logo-img logo-light" />
          </div>
          <!-- NEXUS Brand (always visible) -->
          <span class="header-brand-text">NEXUS</span>
        cssDetails:
          .header-logo:
            minWidth: "80px"
            maxWidth: "160px"
            height: "32px"
          .header-logo-img:
            height: "28px"
            maxWidth: "100%"
            objectFit: "contain"
          .header-brand-text:
            fontFamily: "var(--font-heading)"
            fontSize: "var(--text-xl)"
            color: "var(--text-primary)"
    
    - id: "FR-002"
      name: "Page Switcher Tabs"
      description: "Icon-only tabs in header with tooltips to switch pages"
      priority: "must-have"
      currentState: "FINALIZED - design verified in prototype v7"
      acceptance: |
        - Tabs rendered from PAGE_TABS config array
        - Icons only (no labels) - use Lucide Icons
        - Tooltip appears on hover (below tab)
        - Active tab has brand-primary highlight (circular)
        - Supports badge property for count indicators (uses unified count-badge)
        - RESPONSIVE OVERFLOW:
          - Tabs hide automatically before colliding with search bar
          - Hidden tabs move to "More" (...) dropdown menu
          - "More" button displays SUM of badges from hidden tabs (e.g. "5" + "2" = "7")
          - Dropdown items are fully interactive nav links
      uiDetails:
        js: |
          // Page tabs config - extensible navigation
          const PAGE_TABS = [
            { id: 'dashboard', icon: 'layout-dashboard', label: 'Dashboard' },
            { id: 'incidents', icon: 'alert-triangle', label: 'Incidents', badge: '2' },
            { id: 'reports', icon: 'bar-chart-3', label: 'Reports' },
            { id: 'calendar', icon: 'calendar', label: 'Calendar' },
            // Max recommended: 6-8 tabs
          ];
        html: |
          <nav class="page-tabs" id="page-tabs">
            <button class="page-tab active has-badge" data-page="dashboard">
              <i data-lucide="layout-dashboard"></i>
              <span class="count-badge">3</span>
              <span class="tab-tooltip">Dashboard</span>
            </button>
          </nav>
        cssDetails:
          .page-tab:
            width: "40px"
            height: "40px"
            borderRadius: "50%"
            background: "transparent"
          .page-tab.active:
            color: "var(--brand-primary)"
            background: "rgba(98, 216, 78, 0.15)"
    
    - id: "FR-003"
      name: "AI Search Box"
      description: "Centered search input in header (absolutely positioned)"
      priority: "should-have"
      currentState: "FINALIZED - design verified in prototype v7"
      acceptance: |
        - Search input absolutely centered in viewport
        - Simple input box with placeholder "Ask anything..."
        - Glassmorphism styled with backdrop blur
        - Light theme has distinct border/shadow for visibility
        - Full-width pill shape (max 400px)
        - Focus state shows brand-primary glow
        - Actual search logic NOT in scope (just UI slot)
      uiDetails:
        html: |
          <div class="ai-search-container">
            <input type="text" class="ai-search-box" placeholder="Ask anything..." id="ai-search" />
          </div>
        cssDetails:
          .ai-search-container:
            position: "absolute"
            left: "50%"
            transform: "translateX(-50%)"
            maxWidth: "400px"
          .ai-search-box:
            borderRadius: "var(--radius-full)"
            background: "var(--glass-bg)"
            backdropFilter: "blur(10px)"
          .light-theme .ai-search-box:
            border: "1px solid rgba(0, 0, 0, 0.2)"
            boxShadow: "0 2px 8px rgba(0, 0, 0, 0.08)"
    
    - id: "FR-004"
      name: "Header Action Buttons"
      description: "Notifications, settings, theme toggle, and user avatar on right"
      priority: "should-have"
      currentState: "FINALIZED - design verified in prototype v7"
      acceptance: |
        - Action buttons group pushed to far right (margin-left: auto)
        - Notification bell with count-badge showing count
        - Settings button (Lucide 'settings' icon)
        - Theme toggle (dark/light switch)
        - User avatar with initials
        - All use unified count-badge system when needed
      uiDetails:
        html: |
          <div class="header-actions">
            <div class="has-badge">
              <button class="btn-icon" id="notifications-btn" title="Notifications">
                <i data-lucide="bell"></i>
              </button>
              <span class="count-badge" id="notification-count">5</span>
            </div>
            <button class="btn-icon" id="settings-btn" title="Settings">
              <i data-lucide="settings"></i>
            </button>
            <div class="theme-toggle" id="theme-toggle"></div>
            <div class="user-avatar">MP</div>
          </div>
        cssDetails:
          .header-actions:
            marginLeft: "auto"  # Pushes to far right
          .has-badge:
            position: "relative"
          .count-badge:
            position: "absolute"
            top: "0"
            right: "0"
            background: "#ef4444"  # Red - consistent
            color: "white"
            minWidth: "16px"
            height: "16px"
            borderRadius: "var(--radius-full)"

    # --- FR-004B: Unified Count Badge System ---
    - id: "FR-004B"
      name: "Unified Count Badge System"
      description: "Reusable red circle badge for counters across all components"
      priority: "must-have"
      currentState: "FINALIZED - design verified in prototype v7"
      acceptance: |
        - Single .count-badge CSS class used everywhere
        - Red background (#ef4444) with white text
        - Parent element gets .has-badge class for positioning
        - Positioning variants for nav-item, page-tab, header icons
        - Empty badges hidden (:empty pseudo-class)
        - Config-driven: add badge: 'N' to any config item
      uiDetails:
        usage: |
          // Sidebar nav with badge
          { id: 'incidents', icon: 'alert-triangle', label: 'Incidents', badge: '3' }
          
          // Page tab with badge  
          { id: 'incidents', icon: 'alert-triangle', label: 'Incidents', badge: '2' }
          
          // Notification bell (HTML)
          <div class="has-badge">
            <button class="btn-icon"><i data-lucide="bell"></i></button>
            <span class="count-badge">5</span>
          </div>
        cssDetails:
          .has-badge:
            position: "relative"
          .count-badge:
            position: "absolute"
            top: "0"
            right: "0"
            minWidth: "16px"
            height: "16px"
            background: "#ef4444"
            color: "white"
            fontSize: "10px"
            fontWeight: "600"
            borderRadius: "var(--radius-full)"
          # Positioning variants
          .nav-item .count-badge:
            top: "2px"
            right: "2px"
          .page-tab .count-badge:
            top: "2px"
            right: "2px"

    # --- FR-004C: Floating Header ---
    - id: "FR-004C"
      name: "Floating Header (No Background)"
      description: "Header floats over plasma background without glass effect"
      priority: "should-have"
      currentState: "FINALIZED - design verified in prototype v7"
      acceptance: |
        - Header has NO glass background class
        - Elements float directly over plasma bubbles
        - Search box provides its own glass effect for contrast
        - All header text readable in both themes
      cssDetails:
        .header:
          gridArea: "header"
          position: "sticky"
          top: "0"
          zIndex: "var(--z-header)"
          display: "flex"
          alignItems: "center"
          gap: "var(--space-md)"
          padding: "0 var(--space-lg)"
          height: "var(--header-height)"
          # No background property - floats

    # --- FR-004D: Settings Dialog ---
    - id: "FR-004D"
      name: "Settings Dialog (Full-Screen Modal)"
      description: "Modern settings dialog with left sidebar menu and extensible sections"
      priority: "should-have"
      currentState: "FINALIZED - design verified in prototype v8"
      
      # === DIALOG DESIGN ===
      dialogSpec:
        layout: "Full-screen modal with backdrop blur"
        dimensions:
          maxWidth: "900px"
          height: "80vh"
          maxHeight: "700px"
        structure:
          leftSidebar: "220px - Menu navigation"
          rightContent: "Flexible - Scrollable content area"
          footer: "Fixed - Cancel/Save buttons"
          headerHeight: "64px - Fixed height for both headers, flexbox centered"
        headerAlignment: |
          Both left menu header and right content header use:
          - height: 64px (fixed)
          - display: flex + align-items: center
          - padding: 0 on top/bottom (only horizontal padding)
          This ensures "Settings" and section titles align regardless of font size.
        animation: "Scale-in (0.95 ‚Üí 1) with opacity fade"
        closeActions:
          - "X button (top-right of content header)"
          - "Cancel button (footer)"
          - "ESC key"
          - "Click outside dialog (on overlay)"
      
      # === MENU STRUCTURE (MVP) ===
      menuStructure:
        description: "MVP: 1 group with 2 menu items (per Q-003 decision)"
        defaultSection: "appearance"
        groups:
          - name: "DISPLAY"
            items:
              - { id: "appearance", icon: "palette", label: "Appearance" }
              - { id: "branding", icon: "image", label: "Branding" }
      
      # === EXTENSIBILITY PATTERN ===
      extensibility:
        description: |
          Settings sections are CONFIG-DRIVEN. Factory can extend by adding groups/items.
          To add a new section:
          1. Add menu item to SETTINGS_MENU array
          2. Add section content to SETTINGS_SECTIONS array
          3. No code changes needed - renders automatically
        
        menuConfig: |
          // Gold Source MVP - minimal settings menu
          const SETTINGS_MENU = [
            { group: 'DISPLAY', items: [
              { id: 'appearance', icon: 'palette', label: 'Appearance' },
              { id: 'branding', icon: 'image', label: 'Branding' },
            ]},
            // Factory can add more groups here, e.g.:
            // { group: 'INTEGRATIONS', items: [
            //   { id: 'ai', icon: 'brain', label: 'AI Settings' },
            // ]},
          ];
        
        sectionContentPattern: |
          // Each section has its own content definition
          const SETTINGS_SECTIONS = {
            'appearance': {
              title: 'Appearance',
              sections: [
                {
                  name: 'Theme',
                  settings: [
                    { type: 'select', id: 'color-mode', label: 'Color Mode', 
                      options: ['Dark', 'Light', 'System'] },
                    { type: 'select', id: 'accent-color', label: 'Accent Color',
                      options: ['Green', 'Blue', 'Purple', 'Orange'] },
                  ]
                },
              ]
            },
            'branding': {
              title: 'Branding',
              sections: [
                {
                  name: 'Workspace Logos',
                  settings: [
                    { type: 'file', id: 'logo-dark', label: 'Dark Mode Logo' },
                    { type: 'file', id: 'logo-light', label: 'Light Mode Logo' },
                  ]
                },
              ]
            },
            // Factory adds new sections here
          };
        
        addingSectionGuide: |
          To add a new settings section (e.g., "Keyboard Shortcuts"):
          
          1. Add to SETTINGS_MENU in appropriate group:
             { id: 'shortcuts', icon: 'keyboard', label: 'Keyboard Shortcuts' }
          
          2. Add to SETTINGS_SECTIONS:
             'shortcuts': {
               title: 'Keyboard Shortcuts',
               sections: [
                 { name: 'Navigation', settings: [...] },
                 { name: 'Actions', settings: [...] }
               ]
             }
          
          3. (Optional) If custom rendering needed, add to switch statement
             in renderSettingsSection() function
      
      # === FORM CONTROLS ===
      formControls:
        toggle:
          class: ".toggle-switch"
          activeClass: ".toggle-switch.active"
          css: "width: 48px, height: 26px, green when active"
        select:
          class: ".setting-select"
          css: "min-width: 160px, bg-primary background"
        input:
          class: ".setting-input"
          css: "min-width: 200px, text input styling"
        dangerZone:
          class: ".settings-danger-zone"
          css: "Red border/background, for destructive actions"
      
      # === IMPLEMENTATION PHASES ===
      implementationPhases:
        description: |
          Start simple with 3 functional settings. Add more as functional 
          releases require them. All other settings are visible UI placeholders.
        
        mvp:
          name: "App Shell MVP"
          functionalSettings:
            - id: "color-mode"
              label: "Color Mode (Dark/Light)"
              type: "select"
              storage: "localStorage"
              key: "nexus-theme"
            - id: "accent-color"
              label: "Accent Color"
              type: "select"
              storage: "localStorage"
              key: "nexus-accent"
            - id: "default-page"
              label: "Default Page"
              type: "select"
              storage: "localStorage"
              key: "nexus-default-page"
        
        placeholder:
          description: |
            All other settings are rendered in UI but NOT functional.
            They show the design for future implementation.
          categories:
            - "Preferences (auto-refresh, language, timezone)"
            - "Notifications (all settings)"
            - "AI Settings (all settings)"
            - "Security (all settings)"
            - "Integrations (Connected Apps)"
          addAsNeeded: |
            When a functional release requires a new setting:
            1. Move setting from placeholder to functional
            2. Implement storage and retrieval
            3. Add change handler to apply setting
      
      # === ACCEPTANCE CRITERIA ===
      acceptance: |
        - Dialog opens from settings button with scale animation
        - Left sidebar shows grouped menu items with icons
        - Clicking menu item switches content panel (no reload)
        - Active menu item highlighted in green
        - Content area scrolls independently
        - Toggle switches are interactive
        - Dropdown selects styled consistently
        - Danger Zone clearly styled in red
        - ESC key closes dialog
        - Clicking overlay (outside dialog) closes
        - Save/Cancel buttons in footer
        - New sections addable via config (no code changes)
      
      uiDetails:
        html: |
          <div class="settings-overlay" id="settings-overlay">
            <div class="settings-dialog glass">
              <!-- Left Menu -->
              <nav class="settings-menu">
                <div class="settings-menu-header"><h2>Settings</h2></div>
                <div class="settings-menu-nav">
                  <div class="settings-menu-section">
                    <div class="settings-menu-section-label">GENERAL</div>
                    <button class="settings-menu-item active" data-section="general">
                      <i data-lucide="settings-2"></i> Preferences
                    </button>
                    <!-- More items... -->
                  </div>
                </div>
              </nav>
              
              <!-- Right Content -->
              <div class="settings-content">
                <div class="settings-content-header">
                  <h3 class="settings-content-title">Preferences</h3>
                  <button class="settings-close"><i data-lucide="x"></i></button>
                </div>
                <div class="settings-content-body">
                  <!-- Sections render here -->
                </div>
                <div class="settings-footer">
                  <button class="btn-secondary">Cancel</button>
                  <button class="btn-primary">Save Changes</button>
                </div>
              </div>
            </div>
          </div>
        
        cssDetails:
          .settings-overlay:
            position: "fixed"
            inset: "0"
            backdropFilter: "blur(4px)"
            display: "flex"
            alignItems: "center"
            justifyContent: "center"
          .settings-dialog:
            maxWidth: "900px"
            height: "80vh"
            display: "grid"
            gridTemplateColumns: "220px 1fr"
          .settings-menu:
            background: "var(--bg-primary)"
            borderRight: "1px solid var(--glass-border)"
            padding: "0"
          .settings-menu-header:
            height: "64px"
            display: "flex"
            alignItems: "center"
            padding: "0 var(--space-lg)"
          .settings-content-header:
            height: "64px"
            display: "flex"
            alignItems: "center"
            padding: "0 var(--space-xl)"
          .settings-content-body:
            flex: "1"
            overflowY: "auto"
            padding: "var(--space-xl)"
          .settings-menu-item.active:
            background: "rgba(98, 216, 78, 0.15)"
            color: "var(--brand-primary)"
          .setting-select:
            appearance: "none"
            backgroundImage: "SVG chevron (data URI)"
            backgroundPosition: "right 12px center"
            border: "1px solid rgba(239, 68, 68, 0.3)"
      
    # --- FR-004E: Workspace Branding ---
    - id: "FR-004E"
      name: "Workspace Branding Settings"
      description: "Dedicated settings for logo management and customization"
      priority: "must-have"
      currentState: "FINALIZED - implemented in prototype v8"
      acceptance: |
        - Dedicated "Branding" tab in Settings
        - Dual file uploads: Dark Mode Logo (white text) and Light Mode Logo (dark text)
        - Display Options: "Contain" (default), "Cover", "Fill"
        - Live Preview: Uploaded images update header immediately (File API)
        - Persistence: Choices saved to localStorage (survive reload)
        - Reset buttons to restore defaults

    # --- Sidebar: CONTEXTUAL Page Actions ---
    - id: "FR-005"
      name: "Contextual Sidebar Actions"
      description: "Per-page action buttons - sidebar shows actions relevant to current page"
      priority: "must-have"
      currentState: "DESIGN REVISED - contextual model per user clarification"
      
      # === CRITICAL DESIGN CLARIFICATION ===
      designNote: |
        The sidebar is NOT a duplicate of header tabs (page navigation).
        
        - Header Tabs = PAGE NAVIGATION (switch between pages)
        - Sidebar = PAGE ACTIONS (tools/functions for the current page)
        
        Each page defines its own sidebar buttons. If a page has no actions,
        the sidebar disappears entirely.
      
      acceptance: |
        - Sidebar content is CONTEXTUAL to the current page
        - Each page can define 0 to N sidebar buttons via config
        - Sidebar disappears completely if current page has no buttons
        - Sidebar appears with smooth animation when navigating to page with buttons
        - First button is selected (active) by default when page loads
        - Buttons are config-driven per page (Factory can extend)
      
      configModel: |
        // Pages define their own sidebar actions
        const PAGE_SIDEBAR_ACTIONS = {
          'dashboard': [
            { id: 'refresh', icon: 'refresh-cw', label: 'Refresh Data' },
            // Add more actions as needed
          ],
          'incidents': [
            { id: 'new-incident', icon: 'plus', label: 'New Incident' },
            { id: 'filter', icon: 'filter', label: 'Filter' },
          ],
          'reports': [], // No sidebar for this page
        };
        
        // When page changes, update sidebar
        function updateSidebarForPage(pageId) {
          const actions = PAGE_SIDEBAR_ACTIONS[pageId] || [];
          if (actions.length === 0) {
            sidebar.classList.add('hidden');
          } else {
            sidebar.classList.remove('hidden');
            renderSidebarButtons(actions);
          }
        }
      
      goldSourceMVP: |
        For Gold Source scaffold, implement minimal configuration:
        - 1 page (Dashboard) with 1 sidebar button
        - Factory extends by adding pages and their sidebar actions
    
    - id: "FR-006"
      name: "Floating Pill-Shaped Sidebar"
      description: "Modern floating sidebar with circular button highlights"
      priority: "must-have"
      currentState: "FINALIZED - design verified in prototype"
      acceptance: |
        - Floating pill shape (border-radius: 28px) with gap from left edge
        - Position: fixed, top: 100px (below header)
        - Width: 68px (icon-only, no labels in collapsed state)
        - Height: auto (only as tall as action buttons, not full-height)
        - Circular button highlights (border-radius: 50%, 44px √ó 44px)
        - Tooltip appears on hover (text label slides out to right)
        - Glass effect with backdrop-filter blur
        - Smooth show/hide transition when page changes
        - Hidden class for pages with no actions
      cssDetails: |
        .sidebar {
          position: fixed;
          left: 16px;
          top: 100px;
          width: 68px;
          /* height: auto - only as tall as buttons */
          border-radius: 28px;
          background: var(--glass-bg);
          backdrop-filter: blur(var(--glass-blur));
          z-index: 100;
          padding: 16px 12px;
          transition: opacity 0.2s, transform 0.2s;
        }
        
        .sidebar.hidden {
          opacity: 0;
          transform: translateX(-20px);
          pointer-events: none;
        }
        
        .sidebar-action {
          width: 44px;
          height: 44px;
          border-radius: 50%; /* Circular highlights */
          display: flex;
          align-items: center;
          justify-content: center;
        }
        
        .action-tooltip {
          position: absolute;
          left: 100%;
          opacity: 0;
          transition: opacity 0.2s;
        }
        
        .sidebar-action:hover .action-tooltip {
          opacity: 1;
        }

    # --- Page System ---
    - id: "FR-007"
      name: "Multi-Page Canvas System with Safe Areas"
      description: "Canvas area with defined safe zones and scroll layout options"
      priority: "must-have"
      currentState: "FINALIZED - design verified in prototype v7"
      
      # === CANVAS SAFE AREA STANDARDS ===
      safeAreaSpec:
        description: |
          The canvas is the main content area where page content renders.
          Safe areas ensure content doesn't collide with shell elements.
        
        # Fixed dimensions from app shell
        shellDimensions:
          headerHeight: "var(--header-height)"  # 60px
          sidebarWidth: "var(--sidebar-width)"  # 68px
          sidebarGap: "var(--sidebar-gap)"      # 16px
          
        # Content safe area (after shell elements)
        safeArea:
          top: "0"  # Header is sticky, content scrolls behind
          left: "calc(var(--sidebar-width) + var(--sidebar-gap) * 2)"  # ~100px
          right: "0"
          bottom: "0"
          padding: "var(--space-xl)"  # 32px internal breathing room
          
        # Maximum content width options
        maxContentWidth:
          default: "none"  # Full width to edge
          centered: "1200px"  # Common dashboard max
          narrow: "800px"    # Text-heavy pages, forms
          
        # Reserved zones for floating elements
        reservedZones:
          fabArea: |
            Bottom-right corner reserved for FABs (Floating Action Buttons)
            Keep 80px x 80px clear when FAB is present
          toastArea: |
            Bottom-center for toast notifications
            Keep 48px margin from bottom edge
      
      # === TWO SCROLL LAYOUT OPTIONS ===
      scrollLayouts:
        # OPTION A: Vertical Scroll (Default) - Best for most pages
        verticalScroll:
          name: "Vertical Scroll Layout"
          description: "Content scrolls vertically within canvas. Best for forms, lists, detail views."
          when: "Default for most pages - data tables, forms, article pages"
          cssClass: "canvas--vertical"
          behavior:
            - Content stacks vertically
            - Page scrolls when content exceeds viewport
            - Header remains sticky at top
            - Sidebar remains fixed on left
            - Good for variable-height content
          css: |
            .canvas--vertical {
              overflow-y: auto;
              overflow-x: hidden;
            }
            .canvas--vertical .page-content {
              max-width: 1200px;  /* Optional: center content */
              margin: 0 auto;
            }
            
        # OPTION B: Horizontal Scroll - Best for dashboards/cards
        horizontalScroll:
          name: "Horizontal Scroll Layout"
          description: "Content arranged in horizontal lanes/rows. Best for dashboards with card grids."
          when: "Dashboards, card-based views, Kanban boards, timeline views"
          cssClass: "canvas--horizontal"
          behavior:
            - Content arranged in horizontal rows
            - Each row can scroll horizontally if needed
            - Vertical scroll for row navigation
            - Good for card grids, kanban, swimlanes
          css: |
            .canvas--horizontal {
              display: flex;
              flex-direction: column;
              gap: var(--space-lg);
            }
            .canvas--horizontal .card-row {
              display: flex;
              gap: var(--space-md);
              overflow-x: auto;
              padding-bottom: var(--space-sm);
              scroll-snap-type: x mandatory;
            }
            .canvas--horizontal .card {
              flex-shrink: 0;
              min-width: 300px;
              scroll-snap-align: start;
            }
      
      # === LAYOUT MODE CONFIG ===
      layoutConfig:
        description: "Pages can specify their preferred layout in PAGE_TABS config"
        usage: |
          const PAGE_TABS = [
            { id: 'dashboard', icon: 'layout-dashboard', label: 'Dashboard', layout: 'horizontal' },
            { id: 'incidents', icon: 'alert-triangle', label: 'Incidents', layout: 'vertical' },
            { id: 'reports', icon: 'bar-chart-3', label: 'Reports', layout: 'vertical', maxWidth: '800px' },
          ];
        defaultLayout: "vertical"
        
      # === STANDARD ACCEPTANCE CRITERIA ===
      acceptance: |
        - Canvas has defined safe area with 32px internal padding
        - Content respects sidebar clearance (~100px from left edge)
        - Two layout modes available: vertical-scroll (default) and horizontal-scroll
        - Pages specify layout preference via config
        - Max content width applies when specified (default: full width)
        - FAB zone (80x80px bottom-right) reserved when FAB present
        - Smooth scroll behavior with CSS scroll-behavior: smooth
        - Each page can have its own initialization
        - Pages lazy-load (don't render until first visit)
        
      uiDetails:
        html: |
          <main class="canvas canvas--vertical" id="canvas">
            <!-- Vertical scroll page (default) -->
            <div class="page page--active" id="page-dashboard" data-page="dashboard">
              <div class="page-content" style="max-width: 1200px; margin: 0 auto;">
                <h1 class="page-title">Dashboard</h1>
                <div class="card-grid">
                  <!-- Cards here -->
                </div>
              </div>
            </div>
            
            <!-- Horizontal scroll page (dashboard variant) -->
            <div class="page" id="page-kanban" data-page="kanban">
              <h1 class="page-title">Kanban Board</h1>
              <div class="card-row">
                <!-- Horizontal scrolling cards -->
              </div>
            </div>
          </main>
          
        cssDetails:
          .canvas:
            gridArea: "canvas"
            padding: "var(--space-xl)"  # 32px safe area
            overflowY: "auto"
            position: "relative"
            scrollBehavior: "smooth"
          .page-content:
            maxWidth: "1200px"  # Default, can be overridden
            margin: "0 auto"   # Center when max-width applied
          .card-grid:
            display: "grid"
            gridTemplateColumns: "repeat(auto-fill, minmax(300px, 1fr))"
            gap: "var(--space-lg)"
            
        js: |
          // Page router with layout switching
          function switchPage(pageId) {
            const canvas = document.getElementById('canvas');
            const page = PAGE_TABS.find(p => p.id === pageId);
            
            // Apply layout mode
            canvas.classList.remove('canvas--vertical', 'canvas--horizontal');
            canvas.classList.add(`canvas--${page?.layout || 'vertical'}`);
            
            // Apply max-width if specified
            const content = document.querySelector(`#page-${pageId} .page-content`);
            if (content && page?.maxWidth) {
              content.style.maxWidth = page.maxWidth;
            }
            
            // Show page
            document.querySelectorAll('.page').forEach(p => p.classList.remove('page--active'));
            document.getElementById(`page-${pageId}`)?.classList.add('page--active');
          }
    
    - id: "FR-008"
      name: "Page Registration Pattern"
      description: "Pattern for demos to register new pages"
      priority: "should-have"
      currentState: "NOT IMPLEMENTED"
      acceptance: |
        - Pages registered via function call or config
        - Each page has: id, label, icon, initFn, renderFn
        - Framework handles tab creation and routing
        - Demo just provides the page logic
      uiDetails:
        js: |
          // Demo registers a page
          registerPage({
            id: 'incidents',
            label: 'Incidents',
            icon: 'üö®',
            init: () => { /* one-time setup */ },
            render: (container) => { /* render content */ }
          });

  # Non-functional requirements
  nonFunctional:
    - id: "NFR-001"
      category: "accessibility"
      description: "All interactive elements must be keyboard accessible per LEAP-030"
      acceptance: |
        - Settings dialog: focus trap, ESC to close
        - Page tabs: arrow keys to navigate, Enter to select
        - Sidebar buttons: focusable with visible focus indicators
        - Icon buttons: aria-label required
    
    - id: "NFR-002"
      category: "performance"
      description: "Page switching must feel instant"
      acceptance: "Page content shows within 100ms of tab click"

# =============================================================================
# TECHNICAL APPROACH
# =============================================================================

technicalApproach:
  
  affectedFiles:
    new:
      - file: "core/page-router.js"
        purpose: "Client-side page switching logic"
      - file: "ui/components/settings/settings-ui.js"
        purpose: "Settings panel component (Branding + Appearance only)"
      - file: "ui/components/settings/settings.css"
        purpose: "Settings panel styles"
      # Note: search-ui.js NOT needed per Q-002 - slot only, no separate component
    
    modify:
      - file: "core/constants.js"
        changes:
          - "Add PAGE_TABS config array (page navigation)"
          - "Add PAGE_SIDEBAR_ACTIONS config object (per-page sidebar buttons)"
          - "Add SETTINGS_MENU and SETTINGS_SECTIONS config arrays"
      
      - file: "index.html"
        changes:
          - "Add page containers in canvas"
          - "Update structure for new components"
      
      - file: "ui/components/header/header-ui.js"
        changes:
          - "Add logo image slot"
          - "Add page tabs"
          - "Add search trigger"
          - "Add settings button"
      
      - file: "ui/components/header/header.css"
        changes:
          - "Styles for tabs, search, settings button"
      
      - file: "ui/components/sidebar/sidebar-ui.js"
        changes:
          - "Render nav from config"
          - "Track active page"
      
      - file: "ui/components/sidebar/sidebar.css"
        changes:
          - "Floating/overlay style option"
      
      - file: "core/app.js"
        changes:
          - "Import and initialize page router"
          - "Initialize new components"
    
    delete: []
  
  dependencies:
    - "No new external dependencies"
  
  patterns:
    - "AI-First headers on new files"
    - "Config-driven rendering (nav, pages)"
    - "Lazy page initialization"
    - "Event delegation for tab clicks"
    - "State management via state.js"
  
  risks:
    - risk: "Settings dialog complexity may exceed 500-line limit"
      mitigation: "Split into settings-ui.js (dialog chrome) and settings-sections.js (content rendering)"
    
    - risk: "Tab overflow logic may cause layout issues on edge cases"
      mitigation: "Test with 10+ tabs across multiple viewport widths; prototype already stress-tested"

# =============================================================================
# FACTORY GOVERNANCE IMPACT
# =============================================================================
# Answer: "Does this change introduce new patterns the Factory AI needs to know?"

factoryGovernanceImpact:
  
  introducesNewPatterns: true
  
  governanceUpdatesRequired:
    - file: "GoldSource/meta/architectural-standards.yaml"
      change: "Add 'Page Registration Pattern' section explaining registerPage() API"
    - file: "GoldSource/meta/ARCHITECTURE.yaml"
      change: "Update extensionPoints.addingNewPage with steps for page registration"
    - file: "GoldSource/governance/demo-rules.yaml"
      change: "Add guidance on when to create new pages vs. modify canvas content"
  
  rationale: |
    The page registration pattern (registerPage()) is NEW functionality that Factory AI
    needs to understand when creating multi-page demos. Currently there's no way to add
    pages - this creates the mechanism. Factory runs will need to know:
    - How to register a new page
    - How to link sidebar nav to pages
    - How config-driven navigation works

# =============================================================================
# VERIFICATION PLAN
# =============================================================================

verification:
  
  manualTests:
    - id: "MT-001"
      name: "Customer Logo Display"
      description: "Verify logo image renders in header"
      steps:
        - "Open index.html"
        - "Observe header logo area"
      expectedResult: "Logo image visible (or fallback text)"
    
    - id: "MT-002"
      name: "Page Tab Switching"
      description: "Verify clicking tabs switches pages"
      steps:
        - "Click on different page tabs"
        - "Observe canvas content change"
      expectedResult: "Page content changes, tab highlights"
    
    - id: "MT-003"
      name: "Sidebar Nav Items"
      description: "Verify sidebar shows configured nav items"
      steps:
        - "Open sidebar (if collapsed)"
        - "Observe nav items"
      expectedResult: "Multiple nav items from config"
    
    - id: "MT-004"
      name: "Settings Panel"
      description: "Verify settings panel opens/closes"
      steps:
        - "Click settings icon"
        - "Observe panel"
        - "Click close or outside"
      expectedResult: "Panel opens with sections, closes properly"
    
    - id: "MT-005"
      name: "Add New Page"
      description: "Verify adding a page is simple"
      steps:
        - "Add entry to PAGES config"
        - "Create page container in canvas"
        - "Refresh"
      expectedResult: "New tab appears, clicking shows new page"

# =============================================================================
# APPROVAL
# =============================================================================

approval:
  specApprovedBy: "Matthew Phipps"
  specApprovedDate: "2026-01-21"
  implementationApprovedBy: null
  implementationApprovedDate: null

# =============================================================================
# OPEN QUESTIONS - Decisions needed before implementation
# =============================================================================

openQuestions:
  
  - id: "Q-001"
    topic: "Constants.js Lock Status"
    question: |
      constants.js is LOCKED in ARCHITECTURE.yaml, but this spec adds page/nav config.
      Options:
      A) Unlock constants.js for config data
      B) Create new page-config.js file
      C) Add extension mechanism to constants.js
    status: "resolved"
    decision: |
      Clarification: "Locked" applies to FACTORY runs only, not LEAP. 
      LEAP updates Gold Source scaffold directly.
      Decision: Add PAGE_TABS and SIDEBAR_NAV to constants.js as default configs.
      Factory can extend these via documented patterns, not modify the file.
    decidedBy: "Matthew Phipps"
    decidedDate: "2026-01-21"
  
  - id: "Q-002"
    topic: "AI Search Scope"
    question: |
      FR-003 says "functionality NOT in scope" but includes UI interaction details
      (expanded state, escape to close). Should we:
      A) Keep interactions (slot + basic UX polish)
      B) Remove interactions (truly slot-only: just the button placeholder)
    status: "resolved"
    decision: |
      B) Slot-only. Just the search input box in header.
      Expanded modal, keyboard shortcuts, and interactions deferred to future phase.
      Added to backlog as LEAP-042.
    decidedBy: "Matthew Phipps"
    decidedDate: "2026-01-21"
  
  - id: "Q-003"
    topic: "Settings Panel Scope"
    question: |
      Should the settings panel:
      A) Just be empty shell (button + panel frame)
      B) Include Theme toggle (move from header)
      C) Include Theme + Account minimal sections
    status: "resolved"
    decision: |
      Minimal MVP: Only two sections included:
      1. Branding - Logo upload (dark/light mode), fit options
      2. Appearance - Color Mode (Dark/Light/System), Accent Color
      
      Removed from scope: Preferences, Notifications, Integrations, AI, Security, About.
      These can be added via backlog items when needed.
      
      CRITICAL: Settings must be CONFIG-DRIVEN for Factory extensibility.
      Factory can add new sections by extending SETTINGS_MENU and SETTINGS_SECTIONS arrays.
    decidedBy: "Matthew Phipps"
    decidedDate: "2026-01-21"
  
  - id: "Q-004"
    topic: "Page Registration Priority"
    question: |
      FR-008 (registerPage API) is should-have, but FR-007 (multi-page) is must-have.
      Options:
      A) Make FR-008 must-have (API-driven pages)
      B) Keep FR-008 should-have, use config-only for FR-007
    status: "resolved"
    decision: |
      B) Config-only for MVP.
      
      Pages added by:
      1. Adding entry to PAGE_TABS config array
      2. Creating HTML container in index.html
      
      registerPage() API (FR-008) remains should-have for future enhancement.
      Config approach is simpler and already proven in prototype.
    decidedBy: "Matthew Phipps"
    decidedDate: "2026-01-21"
  
  - id: "Q-005"
    topic: "Sidebar Expand Behavior"
    question: |
      FR-006 says sidebar "overlays on hover" (new behavior).
      Current behavior: sidebar pushes content when expanded.
      Options:
      A) Change to overlay/float (spec as written)
      B) Keep push behavior (no change to current UX)
      C) Make configurable (both options via CSS class)
    status: "resolved"
    decision: |
      A) Floating pill sidebar per prototype.
      
      - Fixed width (68px), never expands
      - Circular button highlights
      - Tooltips appear on hover (slide out to right)
      - No push behavior - content has fixed left margin
      
      This matches the prototype design and provides cleaner visual.
    decidedBy: "Matthew Phipps"
    decidedDate: "2026-01-21"

# =============================================================================
# NOTES
# =============================================================================

notes:
  designPhilosophy: |
    The app shell should be a TEMPLATE, not a finished product.
    Demos should be able to:
    - Swap logo (1 file change)
    - Add pages (1 config entry + content)
    - Add sidebar items (1 config entry)
    - Add settings sections (1 config entry)
    
  extensibilityPrinciple: |
    "If a demo needs to modify 5+ files to add a feature,
     the scaffold isn't extensible enough."
    
  futureEnhancements:
    - "Breadcrumb navigation"
    - "Notification center"
    - "User dropdown menu"
    - "Keyboard shortcuts (‚åòK for search)"
    - "Command palette"
    - "Page transition animations"

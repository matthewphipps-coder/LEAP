# =============================================================================
# PHASE 20: SCAFFOLD FOUNDATION & CONVENTIONS
# STAGE 1: DISCOVERY
# =============================================================================

metadata:
  phase: 20
  phaseName: "ScaffoldFoundation"
  stage: 1
  stageName: "discovery"
  created: "2026-01-20T16:26:00Z"
  status: "in-progress"

# =============================================================================
# PHASE OBJECTIVE
# =============================================================================

objective:
  goal: "Strengthen scaffold foundation with extension mechanisms and codify conventions for Factory consistency"
  
  context: |
    After 7 Factory runs (v0.0.1 â†’ v2.0.2), analysis revealed:
    - Scaffold lacks extension mechanism for locked files (especially state.js)
    - Convention documentation gaps causing inconsistent Factory output
    - 28 proposed backlog items, 12 in scaffold-conventions category
    
    Strategic decision: Combine Sprint 1 (Foundation) + Sprint 2 (Conventions)
    into single phase to accelerate scaffold improvement while maintaining governance.

  approach: "Sprint-based batching"
  sprintName: "Scaffold Foundation & Conventions"
  
  successCriteria:
    - "State extension mechanism implemented and documented"
    - "All locked files audited for extension gaps"
    - "7 convention patterns documented in architectural-standards.yaml"
    - "Factory run validates improvements"

# =============================================================================
# SPRINT SCOPE - 9 Backlog Items
# =============================================================================

sprintScope:
  totalItems: 9
  effortBreakdown:
    medium: 3
    small: 6
  
  items:
    # Sub-Phase A: Extension Points
    - id: "LEAP-032"
      name: "Add State Extension Mechanism"
      category: "scaffold-conventions"
      effort: "Medium"
      type: "code-change"
      description: "Add registerStateSlice() or equivalent to allow features to register state without modifying locked state.js"
      source: "factory-comparison-v2.0.1-vs-v2.0.2"
      target: "GoldSource/scaffold/core/state.js"
      acceptanceCriteria:
        - "state.js exports registerStateSlice(name, initialState, setters)"
        - "Registered slices accessible via getState('sliceName')"
        - "Subscribers notified of slice changes"

    - id: "LEAP-034"
      name: "Audit Locked Files for Extension Gaps"
      category: "scaffold-conventions"
      effort: "Medium"
      type: "documentation"
      description: "Review all locked files and document extension points for each"
      source: "v2.0.2 factory run analysis"
      target: "GoldSource/meta/architectural-standards.yaml"
      lockedFilesToAudit:
        - "core/state.js"
        - "core/firebase.js"
        - "core/constants.js"
        - "core/logger.js"
        - "ui/styles/variables.css"
        - "ui/styles/base.css"
        - "ui/styles/buttons.css"
        - "ui/styles/inputs.css"
      acceptanceCriteria:
        - "All locked files audited for extension needs"
        - "Extension points documented for each"
        - "Gaps identified and backlog updated if needed"

    - id: "LEAP-029"
      name: "Add Path Depth Table"
      category: "scaffold-conventions"
      effort: "Small"
      type: "documentation"
      description: "Document relative path depths for all folder locations"
      source: "factory-comparison-v2.0.0-vs-v2.0.1"
      target: "GoldSource/meta/ARCHITECTURE.yaml"
      acceptanceCriteria:
        - "pathDepths section added to ARCHITECTURE.yaml"
        - "All folder locations documented with correct relative depth"
        - "Prevents import path errors in Factory runs"

    # Sub-Phase B: Data Patterns
    - id: "LEAP-004"
      name: "Mock Data Strategy"
      category: "scaffold-conventions"
      effort: "Small"
      type: "documentation"
      description: "Define when to extend mock-data.js vs create feature-specific data files"
      source: "demo-output-comparison-v1.0.1-vs-v1.0.2"
      target: "GoldSource/meta/architectural-standards.yaml"
      acceptanceCriteria:
        - "Decision tree for mock data placement documented"
        - "Clear criteria for extend vs create new"

    - id: "LEAP-012"
      name: "State Shapes Pattern"
      category: "scaffold-conventions"
      effort: "Medium"
      type: "documentation"
      description: "Define recommended state structure patterns (nested vs sibling)"
      source: "demo-output-comparison-v1.0.1-vs-v1.0.2"
      target: "GoldSource/meta/architectural-standards.yaml"
      acceptanceCriteria:
        - "State shape patterns documented with examples"
        - "Guidance on when to use nested vs sibling state"

    - id: "LEAP-017"
      name: "Status/Enum Values"
      category: "scaffold-conventions"
      effort: "Small"
      type: "documentation"
      description: "Define case conventions for status strings and enums"
      source: "demo-output-comparison-v1.0.1-vs-v1.0.2"
      target: "GoldSource/meta/architectural-standards.yaml"
      acceptanceCriteria:
        - "Case convention defined (lowercase vs Title Case)"
        - "Examples provided for common status values"

    # Sub-Phase C: Code Patterns
    - id: "LEAP-016"
      name: "Service Function Patterns"
      category: "scaffold-conventions"
      effort: "Small"
      type: "documentation"
      description: "Enhance existing naming conventions with standard patterns for load, open, close, send"
      source: "demo-output-comparison-v1.0.1-vs-v1.0.2"
      target: "GoldSource/meta/architectural-standards.yaml"
      acceptanceCriteria:
        - "Standard function name patterns documented"
        - "Examples: loadXxx(), openXxx(), closeXxx(), sendXxx()"

    - id: "LEAP-027"
      name: "AI Service Pattern"
      category: "scaffold-conventions"
      effort: "Small"
      type: "documentation"
      description: "Define when to use dedicated AI service wrapper vs inline AI logic"
      source: "factory-comparison-v2.0.0-vs-v2.0.1"
      target: "GoldSource/meta/architectural-standards.yaml"
      acceptanceCriteria:
        - "Decision tree for AI service architecture"
        - "Examples of dedicated service vs inline approach"

    - id: "LEAP-031"
      name: "Component Initialization Pattern"
      category: "scaffold-conventions"
      effort: "Small"
      type: "documentation"
      description: "Define when to use lazy init vs explicit init patterns"
      source: "demo-output-comparison-v2.0.0-vs-v2.0.1"
      target: "GoldSource/meta/architectural-standards.yaml"
      acceptanceCriteria:
        - "Lazy init vs explicit init patterns documented"
        - "Decision criteria for choosing between patterns"

# =============================================================================
# SUB-PHASE STRUCTURE
# =============================================================================

subPhases:
  A:
    name: "Extension Points"
    items: ["LEAP-032", "LEAP-034", "LEAP-029"]
    focus: "Enable Factory to extend scaffold properly"
    order: "First - unblocks other work"
  
  B:
    name: "Data Patterns"
    items: ["LEAP-004", "LEAP-012", "LEAP-017"]
    focus: "How to structure data"
    order: "Second - related conventions"
  
  C:
    name: "Code Patterns"
    items: ["LEAP-016", "LEAP-027", "LEAP-031"]
    focus: "How to write code"
    order: "Third - related conventions"

# =============================================================================
# IMPLEMENTATION APPROACH
# =============================================================================

implementationApproach:
  strategy: "Batch documentation updates with single code change"
  
  codeChanges:
    count: 1
    file: "GoldSource/scaffold/core/state.js"
    change: "Add registerStateSlice() extension mechanism"
  
  documentationChanges:
    count: 8
    primaryTarget: "GoldSource/meta/architectural-standards.yaml"
    secondaryTarget: "GoldSource/meta/ARCHITECTURE.yaml"
    approach: "Add new sections for each convention pattern"
  
  suggestedOrder:
    1: "LEAP-029 (Path depths) - Quick win, standalone"
    2: "LEAP-032 (State extension) - The code change"
    3: "LEAP-034 (Audit locked files) - Documents new state.js pattern"
    4: "LEAP-004, LEAP-012, LEAP-017 (Data patterns) - Batch together"
    5: "LEAP-016, LEAP-027, LEAP-031 (Code patterns) - Batch together"

# =============================================================================
# VALIDATION PLAN
# =============================================================================

validationPlan:
  method: "Factory run after sprint completion"
  goal: "Create feature using new state extension mechanism"
  validates:
    - "Extension mechanism works correctly"
    - "New conventions are followed by Factory"
    - "Documentation is clear and actionable"

# =============================================================================
# RESEARCH QUESTIONS FOR NEXT STAGE
# =============================================================================

researchQuestions:
  stateExtension:
    - "What API pattern for registerStateSlice()?"
    - "How to handle subscriber notifications for slices?"
    - "Should slices be namespaced or flat?"
  
  lockedFileAudit:
    - "What extension patterns exist for CSS files?"
    - "Does firebase.js need extension mechanism?"
    - "Are there any other locked files missing?"
  
  conventions:
    - "Review existing patterns in Factory outputs"
    - "What variations exist across v1.0.x and v2.0.x demos?"

# =============================================================================
# NEXT STAGE
# =============================================================================

nextStage:
  name: "research"
  requires: "!Proceed"
  focus: "Research existing patterns and design extension mechanisms"

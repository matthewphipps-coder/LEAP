# =============================================================================
# PHASE 21: STANDARDS & TEMPLATES
# STAGE 4: DESIGN
# =============================================================================

metadata:
  phase: 21
  phaseName: "StandardsAndTemplates"
  stage: 4
  stageName: "design"
  created: "2026-01-20T17:39:00Z"
  status: "complete"
  gateApproval: "Stage 3 approved with !Proceed at 2026-01-20T17:39:24Z"
  previousStage: "stage-3-analysis.yaml"

designObjective: "Detailed implementation plan with exact sections to add"

# =============================================================================
# WIREFRAMES
# =============================================================================

wireframes:
  required: false
  reason: "No UI changes - all documentation updates"

# =============================================================================
# FILES TO MODIFY
# =============================================================================

filesToModify:
  
  # --- BATCH 1: Factory Stage Templates ---
  
  - file: "2_GoldSource/governance/templates/stage-3-analysis.yaml"
    item: "LEAP-021"
    changes: |
      Enhance approachOptions section with clearer APPROACH-A/B/C labeling.
      Change 'option: "A"' to include explicit APPROACH prefix in comments.
      Add mandatory note about using consistent format.
    insertAt: "After line 55 (before approachOptions section)"
    newContent: |
      # APPROACH OPTION FORMAT:
      # Use consistent APPROACH-A/B/C naming for options.
      # Each option must have: name, description, pros, cons, recommended.
  
  - file: "2_GoldSource/governance/templates/stage-4-design.yaml"
    items: ["LEAP-007", "LEAP-008"]
    changes: |
      Add dependencyGraph section (LEAP-007)
      Add complexityEstimates section (LEAP-008)
    insertAt: "After wireframes section (line 50), before filesToModify"
    newContent: |
      # =============================================================================
      # DEPENDENCY GRAPH (LEAP-007)
      # =============================================================================
      dependencyGraph:
        description: "Show component/file relationships for this feature"
        format: |
          Parent → Child pattern showing data flow
        
        graph:
          - from: "[source component/file]"
            to: "[dependent component/file]"
            type: "[imports|calls|updates|renders]"
        
        example: |
          incident-service.js → incident-cards-ui.js (calls)
          incident-data.js → incident-service.js (imports)
          state.js → incident-service.js (subscribes)
      
      # =============================================================================
      # COMPLEXITY ESTIMATES (LEAP-008)
      # =============================================================================
      complexityEstimates:
        description: "Effort estimate for implementation"
        
        overall: "[small|medium|large]"
        
        breakdown:
          - component: "[component name]"
            effort: "[small|medium|large]"
            reason: "[why this effort level]"
        
        definitions:
          small: "< 1 hour, straightforward changes"
          medium: "1-3 hours, some complexity or multiple files"
          large: "> 3 hours, significant changes or new patterns"
  
  - file: "2_GoldSource/governance/templates/stage-6-validation.yaml"
    item: "LEAP-022"
    changes: "Add detailed validationMatrix section with field-by-field validation"
    insertAt: "After featureValidation section (line 55), before documentationValidation"
    newContent: |
      # =============================================================================
      # DETAILED VALIDATION MATRIX (LEAP-022)
      # =============================================================================
      validationMatrix:
        description: "Field-by-field validation of implemented features"
        
        featureChecks:
          - feature: "[Feature name from Discovery]"
            requirements:
              - requirement: "[Specific requirement]"
                implemented: "[true|false]"
                location: "[file:line or component]"
                verified: "[how verified]"
        
        dataModelChecks:
          description: "Verify data structures match design"
          checks:
            - entity: "[data type, e.g., Incident]"
              fields:
                - field: "[field name]"
                  expectedType: "[string|number|array|object]"
                  actualType: "[what was implemented]"
                  matches: "[true|false]"
        
        integrationChecks:
          - check: "[Integration point]"
            expected: "[Expected behavior]"
            actual: "[Actual behavior]"
            status: "[pass|fail]"
  
  - file: "2_GoldSource/governance/templates/stage-7-testing.yaml"
    item: "LEAP-009"
    changes: "Add testEvidence section with storage location requirements"
    insertAt: "After summary section (line 74), before issuesFound"
    newContent: |
      # =============================================================================
      # TEST EVIDENCE (LEAP-009)
      # =============================================================================
      testEvidence:
        description: "Screenshots and recordings documenting test execution"
        storageLocation: "[FACTORY_WORKSPACE]/evidence/"
        
        required:
          screenshots:
            mandatory: true
            naming: "TC-[id]-[description].png"
            examples:
              - "TC-001-dashboard-load.png"
              - "TC-002-card-click.png"
          
          recordings:
            mandatory: "For complex flows"
            naming: "[feature]-demo.webp"
            when: "Multi-step interactions, animations, state changes"
            examples:
              - "incident-dialog-flow.webp"
              - "card-interaction.webp"
        
        artifacts:
          - type: "[screenshot|recording]"
            file: "[filename]"
            testCase: "[TC-XXX]"
            description: "[what it shows]"

  # --- BATCH 2: Scaffold Conventions ---
  
  - file: "2_GoldSource/meta/architectural-standards.yaml"
    items: ["LEAP-019", "LEAP-030"]
    changes: |
      Add componentCreationPolicy section (LEAP-019)
      Add accessibilityRequirements section (LEAP-030)
    insertAt: "After codePatterns section (end of file)"
    newContent: |
      # =============================================================================
      # COMPONENT CREATION POLICY (Phase 21 - LEAP-019)
      # =============================================================================
      
      componentCreationPolicy:
        name: "Create vs Modify Decision Tree"
        purpose: "When to create new components vs modify existing flexible ones"
        addedDate: "2026-01-20"
        source: "Phase 21 - StandardsAndTemplates"
        
        decisionTree:
          createNew:
            when:
              - "Feature has unique visual design not matching existing components"
              - "Feature has distinct interaction patterns"
              - "Feature would require >50% rewrite of existing component"
              - "Feature serves different domain (e.g., incidents vs tasks)"
            location: "ui/components/{new-name}/"
            naming: "{name}-ui.js + {name}.css"
          
          modifyExisting:
            when:
              - "Feature is variation of existing component (e.g., different card type)"
              - "Feature extends existing behavior with <50% changes"
              - "Feature uses same visual patterns with different data"
            flexibleComponents:
              - "ui/components/chat-panel/* - Chat interface"
              - "ui/components/data-cards/* - Data display"
              - "ui/components/action-buttons/* - Quick actions"
            reference: "demo-rules.yaml scaffoldRules.flexible"
        
        examples:
          createNew:
            - scenario: "Incident management with cards, dialogs, status badges"
              reason: "Unique domain with specific data model and interactions"
              result: "Create features/incident/, ui/components/incident-cards/"
          
          modifyExisting:
            - scenario: "New card type for tasks"
              reason: "Same visual pattern as data-cards, different data"
              result: "Modify ui/components/data-cards/ with new render function"
      
      # =============================================================================
      # ACCESSIBILITY REQUIREMENTS (Phase 21 - LEAP-030)
      # =============================================================================
      
      accessibilityRequirements:
        name: "Accessibility Standards"
        purpose: "Ensure all components support keyboard navigation and assistive technology"
        addedDate: "2026-01-20"
        source: "Phase 21 - StandardsAndTemplates"
        
        keyboardNavigation:
          required: true
          rule: "All interactive elements must be keyboard accessible"
          
          requirements:
            - element: "Clickable elements (cards, buttons, links)"
              requirement: "Must support Enter and Space key activation"
              implementation: |
                element.addEventListener('keydown', (e) => {
                  if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleClick(e);
                  }
                });
            
            - element: "Focus indicators"
              requirement: "Visible focus state for all interactive elements"
              implementation: "Use CSS :focus-visible for focus styling"
            
            - element: "Tab order"
              requirement: "Logical tab order matching visual layout"
              implementation: "Use natural DOM order, avoid positive tabindex"
        
        ariaLabels:
          required: "For non-text interactive elements"
          examples:
            - element: "Icon buttons"
              label: "aria-label=\"Close dialog\""
            - element: "Status badges"
              label: "aria-label=\"Status: Active\""
        
        colorContrast:
          requirement: "WCAG 2.1 AA minimum (4.5:1 for text, 3:1 for UI)"
          note: "Base theme variables already meet this requirement"

# =============================================================================
# FILES TO CREATE
# =============================================================================

filesToCreate:
  - file: "2_GoldSource/governance/templates/README.md"
    item: "LEAP-015"
    purpose: "Standard README template for demo output"
    content: |
      # [DEMO_NAME]
      
      > [One-line description of what this demo shows]
      
      ## Overview
      
      [2-3 sentences describing the demo purpose and target use case]
      
      ## Features
      
      - **[Feature 1]**: [Brief description]
      - **[Feature 2]**: [Brief description]
      - **[Feature 3]**: [Brief description]
      
      ## Quick Start
      
      ```bash
      # Navigate to demo directory
      cd [DEMO_OUTPUT]
      
      # Start local server
      python3 -m http.server 8080
      
      # Open in browser
      open http://localhost:8080
      ```
      
      ## Demo Walkthrough
      
      1. **[Step 1]**: [What to do and what happens]
      2. **[Step 2]**: [What to do and what happens]
      3. **[Step 3]**: [What to do and what happens]
      
      ## Technical Notes
      
      - Built on NEXUS scaffold v[X.X.X]
      - Uses [key technologies/patterns]
      - [Any special setup or requirements]
      
      ## Files Modified
      
      | File | Changes |
      |------|---------|
      | [file1.js] | [What was changed] |
      | [file2.css] | [What was changed] |
      
      ---
      
      *Created by DemoFactory on [DATE]*

# =============================================================================
# IMPLEMENTATION STEPS
# =============================================================================

implementationSteps:
  1: "Update stage-3-analysis.yaml - add approachOptions format note (LEAP-021)"
  2: "Update stage-4-design.yaml - add dependencyGraph and complexityEstimates (LEAP-007, LEAP-008)"
  3: "Update stage-6-validation.yaml - add validationMatrix section (LEAP-022)"
  4: "Update stage-7-testing.yaml - add testEvidence section (LEAP-009)"
  5: "Update architectural-standards.yaml - add componentCreationPolicy and accessibilityRequirements (LEAP-019, LEAP-030)"
  6: "Create README.md template (LEAP-015)"
  7: "Update CURRENT_STATE.yaml with implementation progress"
  8: "Mark all 8 items as complete in backlog.yaml"

# =============================================================================
# SCOPE CHANGES
# =============================================================================

scopeChanges:
  intentionallyDeferred: []
  notImplemented: []
  note: "All 8 items from refined scope will be implemented"

# =============================================================================
# TRACEABILITY REVIEW
# =============================================================================

traceabilityReview:
  stage1Discovery:
    file: "stage-1-discovery.yaml"
    verify: "10 items scoped → 2 already done → 8 items remain"
    confirmed: true
  
  stage2Research:
    file: "stage-2-research.yaml"
    verify: "8 items identified with specific changes needed"
    confirmed: true
  
  stage3Analysis:
    file: "stage-3-analysis.yaml"
    verify: "Batch-by-file approach, 6 file operations"
    confirmed: true
  
  confirmation:
    allFeaturesAddressed: true
    gapsExplained: true

# =============================================================================
# NEXT STAGE
# =============================================================================

nextStage:
  name: "implementation"
  requires: "!Proceed"
  criticalGate: true
  note: "File operations begin after this gate - Constitution Rule 3 applies"
